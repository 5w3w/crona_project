<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Календарб</title>
		<style type="text/css">
			@font-face {
				font-family: 'Gramatika';
				src: url('Gramatika-Regular.woff2');
			}

			html, body {
				margin: 0px;
				padding: 0px;
				font-family: Gramatika;
				font-size: 1.5rem;
				background: #0F1C2E;
				color: #F1F1F1;
				min-height: 100vh;
				max-height: 100vh;
				min-width: 100vw;
				max-width: 100vw;
			}

			header.year-month {
				display: flex;
				flex-direction: column;
				justify-content: center;
				align-items: center;
			}

			header.days {
				display: flex;
				flex-direction: row;
				justify-content: center;
			}

			header.days > span {
				flex: 1;
				text-align: center;
			}

			div.divider {
				min-width: 1rem;
			}

			content#days {
				display: grid;
				grid-template-columns: repeat(7, 1fr);
			}

			day {
				border: 1px solid #F1F1F1;
				text-align: center;
				display: flex;
				flex-direction: column;
			}

			day > events {
				min-height: 4rem;
			}

			day > span {
				min-height: 2rem;
			}

			day > span {
			 	text-align: left;
				padding-left: 1rem;
/*				-webkit-text-stroke-width: 2px;*/
/*				-webkit-text-stroke-color: black;*/
			}

			day.inactive > * {
				opacity: 0.33;
			}

			day.today {
				background: #912D26;
			}

			@media (orientation: landscape) {
				main#calendar {
					margin: 0px 15vw;
				}
			}

			@media (orientation: portrait) {
				html, body {
					font-size: 1rem;
				}

				main {
					min-height: 100vh;
					max-height: 100vh;
					min-width: 100vw;
					max-width: 100vw;
				}

				main > header {
					min-height: 5rem;
					max-height: 5rem;
				}

				main > content {
					min-height: calc(100vh - 5rem);
					max-height: calc(100vh - 5rem);
					display: flex;
					flex-direction: row;
					justify-content: center;
					align-items: center;
				}

				main > content > content {
					width: 100%;
				}
			}

			content#days {
				border: 1px solid #F1F1F1;
			}

			.month-button {
				border: none;
				outline: none;
				background: #0000;
				font-size: 2rem;
				color: #F1F1F1;
				-webkit-text-stroke-width: 2px;
				-webkit-text-stroke-color: black;
			}

			main {
				display: none;
				flex-direction: column;
			}

			main.visible {
				display: flex; !important;
			}

			content.calendar {

			}
		</style>
	</head>
	<body>
		<main id="calendar" class="visible">
			<header class="year-month">
				<span id="year">2024</span>
				<!-- <div class="divider"></div> -->
				<span>
					<button class="month-button" id="button-prev-month">&lt;</button>
					<span id="month">Сентябрь</span>
					<button class="month-button" id="button-next-month">&gt;</button>
				</span>
			</header>
			<content class="calendar-container">
				<content class="calendar">
					<header class="days">
						<span>Пн</span>
						<span>Вт</span>
						<span>Ср</span>
						<span>Чт</span>
						<span>Пт</span>
						<span>Сб</span>
						<span>Вс</span>
					</header>
					<content id="days">
					</content>
				</content>
			</content>
		</main>
		<main id="timetable">
			<span></span>
		</main>
	</body>
	<script>
	/*
	#912D26 - сегодня
	#0F1C2E - фон
	#FFE7D3 - события
	#F1F1F1 - разделение
	*/
	</script>
	<script type="text/javascript">
		function day_click(day) {
			console.log(day.date.getDate());
			document.getElementById("timetable").classList.add("visible");
			document.getElementById("calendar").classList.remove("visible");
		}
	</script>
	<script type="text/javascript">
		function getDaysInMonth(month, year) {
			var date = new Date(year, month, 1);
			var days = [];
			while (date.getMonth() === month) {
				days.push(new Date(date));
				date.setDate(date.getDate() + 1);
			}
			return days;
		}

		function isToday(date) {
			return (new Date()).toDateString() === date.toDateString()
		}
 
		function calendar_render(month, year, events) {
			let calendar = document.getElementById('calendar');
			let calendar_days = [];
			let this_month = getDaysInMonth(month, year);
			if (this_month[0].getDay() != 1) {
				let p_year = year - (month == 0 ? 1 : 0);
				let p_month = (month == 0) ? 11 : (month - 1);
				let past_month = getDaysInMonth(p_month, p_year);
				let first_day_index = 0;
				for (let i = 0; i < past_month.length; i++)
					if (past_month[i].getDay() == 1) first_day_index = i;
				for (let i = first_day_index; i < past_month.length; i++)
					calendar_days.push(past_month[i]);
			}
			for (let i = 0; i < this_month.length; i++)
				calendar_days.push(this_month[i]);
			if (this_month[this_month.length - 1].getDay() != 0) {
				let p_year = year + (month == 11 ? 1 : 0);
				let p_month = (month == 11) ? 0 : (month + 1);
				let next_month = getDaysInMonth(p_month, p_year);
				let first_day_index = 0;
				for (let i = 0; i < next_month.length; i++) {
					if (next_month[i].getDay() == 0) {
						first_day_index = i;
						break;
					}
				}
				for (let i = 0; i <= first_day_index; i++)
					calendar_days.push(next_month[i]);
			}
			let days_element = document.getElementById("days");
			days_element.innerHTML = "";
			calendar_days.forEach((it) => {
				let day = document.createElement("day");
				day.onclick = () => day_click(day);
				day.date = it;
				let day_span = document.createElement("span");
				let day_events = document.createElement("events");
				day_span.innerText = it.getDate();
				day.appendChild(day_span);
				day.appendChild(day_events);
				if (isToday(it)) day.classList.add("today");
				if (it.getMonth() != month) day.classList.add("inactive");
				days_element.appendChild(day);
			})
			calendar.year = year;
			calendar.month = month;
		}

		calendar_render((new Date()).getMonth(), (new Date()).getFullYear());

		let months_names = "Январь Февраль Март Апрель Май Июнь Июль Август Сентябрь Октябрь Ноябрь Декабрь".split(' ');

		document.getElementById('button-prev-month').onclick = (event) => {
			let calendar = document.getElementById('calendar');
			let month = (calendar.month == 0) ? 11 : calendar.month - 1;
			if (month == 11) calendar.year -= 1;
			calendar_render(month, calendar.year);
			document.getElementById('month').innerText = months_names[month];
			document.getElementById('year').innerText = calendar.year.toString();
		}

		document.getElementById('button-next-month').onclick = (event) => {
			let calendar = document.getElementById('calendar');
			let month = (calendar.month == 11) ? 0 : calendar.month + 1;
			if (month == 0) calendar.year += 1;
			calendar_render(month, calendar.year);
			document.getElementById('month').innerText = months_names[month];
			document.getElementById('year').innerText = calendar.year.toString();
		}

		let touchstartX = 0;
		let touchendX = 0;

		function checkDirection() {
			if ((touchendX - touchstartX) / window.screen.width < -0.35) {
				let calendar = document.getElementById('calendar');
				let month = (calendar.month == 11) ? 0 : calendar.month + 1;
				if (month == 0) calendar.year += 1;
				calendar_render(month, calendar.year);
				document.getElementById('month').innerText = months_names[month];
				document.getElementById('year').innerText = calendar.year.toString();
			}
			if ((touchendX - touchstartX) / window.screen.width > 0.35) {
				let calendar = document.getElementById('calendar');
				let month = (calendar.month == 0) ? 11 : calendar.month - 1;
				if (month == 11) calendar.year -= 1;
				calendar_render(month, calendar.year);
				document.getElementById('month').innerText = months_names[month];
				document.getElementById('year').innerText = calendar.year.toString();
			}
		}

		document.addEventListener('touchstart', e => {
			touchstartX = e.changedTouches[0].screenX;
		})

		document.addEventListener('touchmove', e => {
			touchendX = e.changedTouches[0].screenX;
		})

		document.addEventListener('touchend', e => {
			checkDirection();
		})
	</script>
</html>